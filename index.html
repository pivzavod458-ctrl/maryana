<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–î–ª—è –ú–∞—Ä—å—è–Ω—ã ‚ù§Ô∏è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –û–ë–©–ò–ô –°–¢–ò–õ–¨ "–ö–†–ò–ù–ñ-–û–¢–ö–†–´–¢–ö–ê" */
        body {
            background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            text-align: center;
            color: #590000;
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .active { display: flex; }

        h1, h2 { text-shadow: 2px 2px 0px #fff; margin: 10px; }
        p { font-size: 18px; font-weight: bold; }

        /* –ö–ù–û–ü–ö–ò –ò –ü–û–õ–Ø */
        .btn {
            background: linear-gradient(to bottom, #ff00cc, #333399);
            border: 5px solid #fff;
            border-radius: 20px;
            color: yellow;
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            margin-top: 15px;
            text-transform: uppercase;
            font-family: 'Comic Sans MS', sans-serif;
        }
        
        .btn:active { transform: scale(0.95); }

        input, textarea {
            width: 90%;
            padding: 15px;
            border: 5px dashed red;
            background: #fff0f5;
            font-size: 18px;
            font-family: 'Comic Sans MS', sans-serif;
            border-radius: 15px;
            margin: 10px 0;
        }

        /* –ò–ì–†–ê */
        .game-wrapper {
            position: relative;
            width: 95%;
            height: 60%;
            border: 8px ridge gold;
            overflow: hidden;
            border-radius: 10px;
        }

        .game-area {
            width: 100%;
            height: 100%;
            background-color: #7a5c5c;
            /* –ö–æ–≤–µ—Ä */
            background-image: repeating-linear-gradient(45deg, #7a5c5c 25%, transparent 25%, transparent 75%, #7a5c5c 75%, #7a5c5c), repeating-linear-gradient(45deg, #7a5c5c 25%, #5e3b3b 25%, #5e3b3b 75%, #7a5c5c 75%, #7a5c5c);
            background-position: 0 0, 10px 10px;
            background-size: 20px 20px;
            position: relative;
            cursor: crosshair;
        }

        .fighter {
            position: absolute;
            font-size: 40px; /* –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –ø–æ–º–µ–Ω—å—à–µ */
            transition: all 0.3s linear; /* –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ */
            width: 40px;
            height: 40px;
            text-align: center;
            line-height: 40px;
            z-index: 10;
        }

        .hp-bar-container {
            position: absolute;
            top: 5px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            box-sizing: border-box;
            z-index: 20;
        }

        .hp-bar {
            width: 100px;
            height: 15px;
            background: red;
            border: 2px solid white;
        }

        #countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            color: yellow;
            text-shadow: 5px 5px 0 red;
            z-index: 100;
            display: none;
        }

        /* –°–ö–ê–ù–ï–† */
        #video-container {
            width: 250px;
            height: 250px;
            border: 10px groove gold;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
            background: black;
        }
        video { width: 100%; height: 100%; object-fit: cover; }
        .scan-line {
            position: absolute;
            width: 100%; height: 5px; background: lime;
            animation: scan 1.5s infinite linear;
        }
        @keyframes scan { 0%{top:0} 100%{top:100%} }

        /* –í–ê–†–ò–ê–ù–¢–´ –û–¢–í–ï–¢–ê */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            width: 100%;
        }
    </style>
</head>
<body>

    <div id="screen1" class="screen active">
        <h1>–ó–î–†–ê–í–°–¢–í–£–ô–¢–ï!!!</h1>
        <img src="https://media1.tenor.com/m/KWA2wQk9X7QAAAAC/rose-flower.gif" style="width: 150px; border-radius: 50%; border: 5px dotted gold;">
        <h2>–í–´ –ú–ê–†–¨–Ø–ù–ê???</h2>
        <button class="btn" onclick="startScan()">–î–ê, –≠–¢–û –Ø!</button>
    </div>

    <div id="screen2" class="screen">
        <h2>–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï...</h2>
        <p>–ü–æ–∫—Ä—É—Ç–∏ –≥–æ–ª–æ–≤–æ–π (–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º) –≤–ø—Ä–∞–≤–æ!</p>
        <div id="video-container">
            <video id="camera" autoplay playsinline muted></video>
            <div class="scan-line"></div>
        </div>
        <div id="scan-status" style="font-size: 24px; color: blue; background: #fff; padding: 5px;">0%</div>
        <button id="skip-scan" style="display:none; font-size:10px; margin-top:20px;" onclick="finishScan()">–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å (–µ—Å–ª–∏ –≥–ª—é—á–∏—Ç)</button>
    </div>

    <div id="screen3" class="screen">
        <h2>–ò–ì–†–ê: –î–ê–ô –õ–Æ–õ–ï–ô –°–ê–®–ï</h2>
        <p style="font-size: 14px;">–¢—ã–∫–∞–π –ø–æ –∫–æ–≤—Ä—É, —á—Ç–æ–±—ã –±–µ–∂–∞—Ç—å. <br> –î–æ–≥–æ–Ω–∏ –°–∞—à—É –∏ —Ç—ã–∫–Ω–∏ –í –ù–ï–ì–û!</p>
        <div class="game-wrapper">
            <div class="hp-bar-container">
                <div>–¢–´: <div id="p-hp" class="hp-bar"></div></div>
                <div>–°–ê–®–ê: <div id="b-hp" class="hp-bar"></div></div>
            </div>
            <div class="game-area" id="game-area" onclick="movePlayer(event)">
                <div id="player" class="fighter">üíÉ</div>
                <div id="bot" class="fighter" onclick="hitBot(event)">üèÉ‚Äç‚ôÇÔ∏è</div>
                <div id="countdown">3</div>
            </div>
        </div>
    </div>

    <div id="screen4" class="screen">
        <h2>–í–û–ü–†–û–° 1</h2>
        <p>–ù–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ —Ç—ã –ª—é–±–∏—à—å –°–∞—à—É?</p>
        <p style="font-size: 12px;">(–ù—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –º–Ω–æ–≥–æ, –º–∏–Ω–∏–º—É–º 50 –±—É–∫–≤!)</p>
        <textarea id="love-text" rows="5" oninput="checkLoveText()"></textarea>
        <div id="char-count">0 / 50</div>
        <button id="btn-q1" class="btn" style="opacity: 0.5; pointer-events: none;" onclick="nextScreen('screen5')">–û–¢–í–ï–¢–ò–¢–¨</button>
    </div>

    <div id="screen5" class="screen">
        <h2>–í–û–ü–†–û–° 2</h2>
        <p>–ß—Ç–æ –±—ã –°–∞—à–∞ —Å–µ–π—á–∞—Å —Å—ä–µ–ª?</p>
        <input type="text" id="food-input">
        <button class="btn" onclick="checkFood()">–ì–û–¢–û–í–û</button>
    </div>

    <div id="screen6" class="screen">
        <h2>–í–û–ü–†–û–° 3</h2>
        <p>–ß—Ç–æ –°–∞—à–∞ –ª—é–±–∏—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –Ω–∞ —Å–≤–µ—Ç–µ?</p>
        <div class="options-grid">
            <button class="btn" onclick="nextScreen('screen7')">–ú–ê–†–¨–Ø–ù–£</button>
            <button class="btn" onclick="nextScreen('screen7')">–ú–ê–†–¨–Ø–ù–£</button>
            <button class="btn" onclick="nextScreen('screen7')">–ú–ê–†–¨–Ø–ù–£</button>
            <button class="btn" onclick="alert('–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! –¢–´ –ß–ï–ì–û!!!')">–î–ï–ù–¨–ì–ò</button>
        </div>
    </div>

    <div id="screen7" class="screen">
        <h1 style="color: red; font-size: 40px;">–í–ù–ò–ú–ê–ù–ò–ï –ó–ê–î–ê–ù–ò–ï!</h1>
        <p>–ü–û–ö–ê–ñ–ò –°–ò–°–¨–ö–£ –í –ö–ê–ú–ï–†–£!</p>
        <p>–£ —Ç–µ–±—è 5 —Å–µ–∫—É–Ω–¥, –∏–Ω–∞—á–µ –ø—Ä–æ–∏–≥—Ä–∞–µ—à—å!</p>
        <div id="boob-timer" style="font-size: 80px; font-weight: bold;">5</div>
    </div>

    <div id="screen8" class="screen">
        <h1>–° 14 –§–ï–í–†–ê–õ–Ø! ‚ù§Ô∏è</h1>
        <div style="font-size: 60px;">üòΩüíêüéÜ</div>
        <p>–Ø —Ç–µ–±—è –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –ª—é–±–ª—é!</p>
        <p>–¢—ã –ø—Ä–æ—à–ª–∞ –≤—Å–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è!</p>
        <p>–¢–≤–æ–π –°–∞—à–∞</p>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        function nextScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // --- –°–ö–ê–ù–ï–† (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞) ---
        let scanProgress = 0;
        let video = document.getElementById('camera');
        
        function startScan() {
            nextScreen('screen2');
            navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
                .then(stream => { video.srcObject = stream; })
                .catch(e => document.getElementById('skip-scan').style.display = 'block');
            
            window.addEventListener('deviceorientation', (e) => {
                if(Math.abs(e.gamma) > 10) scanProgress += 4;
                updateScan();
            });
            setInterval(() => { scanProgress += 1; updateScan(); }, 200);
        }

        function updateScan() {
            if(scanProgress > 100) scanProgress = 100;
            document.getElementById('scan-status').innerText = scanProgress + '%';
            if(scanProgress === 100) finishScan();
        }

        let scanDone = false;
        function finishScan() {
            if(scanDone) return;
            scanDone = true;
            nextScreen('screen3');
            initGame();
        }

        // --- –°–õ–û–ñ–ù–ê–Ø –ò–ì–†–ê ---
        let pHealth = 10;
        let bHealth = 10;
        let gameActive = false;
        let gameArea = document.getElementById('game-area');
        let player = document.getElementById('player');
        let bot = document.getElementById('bot');

        function initGame() {
            let count = 3;
            let cdEl = document.getElementById('countdown');
            cdEl.style.display = 'block';
            let timer = setInterval(() => {
                cdEl.innerText = count;
                count--;
                if(count < 0) {
                    clearInterval(timer);
                    cdEl.innerText = "–ë–û–ô!";
                    setTimeout(() => cdEl.style.display = 'none', 1000);
                    startGameLoop();
                }
            }, 1000);
        }

        function startGameLoop() {
            gameActive = true;
            botRunLoop(); // –ë–æ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç –±–µ–≥–∞—Ç—å
        }

        // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ (–∫—É–¥–∞ —Ç—ã–∫–Ω—É–ª–∞)
        function movePlayer(e) {
            if(!gameActive) return;
            // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–∫–∞ –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª—è
            let rect = gameArea.getBoundingClientRect();
            let x = e.clientX - rect.left - 20; // -20 —ç—Ç–æ –ø–æ–ª–æ–≤–∏–Ω–∞ —à–∏—Ä–∏–Ω—ã –ø–µ—Ä—Å–∞
            let y = e.clientY - rect.top - 20;
            
            player.style.left = x + 'px';
            player.style.top = y + 'px';
        }

        // –ë–æ—Ç —É–±–µ–≥–∞–µ—Ç
        function botRunLoop() {
            if(!gameActive) return;
            // –ë–æ—Ç –º–µ–Ω—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∫–∞–∂–¥—ã–µ 600–º—Å (–¥–æ–≤–æ–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ)
            let rect = gameArea.getBoundingClientRect();
            let randX = Math.random() * (rect.width - 50);
            let randY = Math.random() * (rect.height - 50);
            
            bot.style.left = randX + 'px';
            bot.style.top = randY + 'px';

            setTimeout(botRunLoop, 600);
        }

        // –£–¥–∞—Ä –ø–æ –±–æ—Ç—É
        function hitBot(e) {
            e.stopPropagation(); // –ß—Ç–æ–±—ã –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞–ª–æ—Å—å –∫–∞–∫ –¥–≤–∏–∂–µ–Ω–∏–µ
            if(!gameActive) return;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–Ω—É–∂–Ω–æ –±—ã—Ç—å –±–ª–∏–∑–∫–æ)
            let pRect = player.getBoundingClientRect();
            let bRect = bot.getBoundingClientRect();
            let dist = Math.hypot(pRect.x - bRect.x, pRect.y - bRect.y);

            if(dist < 80) { // –ï—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª–∏–∑–∫–æ
                bHealth--;
                updateHP();
                bot.innerText = "üòµ";
                setTimeout(() => bot.innerText = "üèÉ‚Äç‚ôÇÔ∏è", 300);
                
                // –ë–æ—Ç —Å—Ä–∞–∑—É —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ —É–¥–∞—Ä–∞
                let rect = gameArea.getBoundingClientRect();
                bot.style.left = Math.random() * (rect.width - 50) + 'px';
                bot.style.top = Math.random() * (rect.height - 50) + 'px';

                if(bHealth <= 0) winGame();
            } else {
               // –°–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ
               alert("–°–Ω–∞—á–∞–ª–∞ –¥–æ–≥–æ–Ω–∏!");
            }
        }

        function updateHP() {
            document.getElementById('b-hp').style.width = (bHealth * 10) + 'px';
            // –°–∞—à—É –±–∏—Ç—å –Ω–µ–ª—å–∑—è (–≤ –ø–ª–∞–Ω–µ –æ–Ω –Ω–µ –±—å–µ—Ç –≤ –æ—Ç–≤–µ—Ç, –ø—Ä–æ—Å—Ç–æ —É–±–µ–≥–∞–µ—Ç)
        }

        function winGame() {
            gameActive = false;
            alert("–¢–´ –ü–û–ë–ï–î–ò–õ–ê –°–ê–®–£!");
            nextScreen('screen4');
        }

        // --- –í–û–ü–†–û–° 1 (50 —Å–∏–º–≤–æ–ª–æ–≤) ---
        function checkLoveText() {
            let text = document.getElementById('love-text').value;
            let count = text.length;
            let countEl = document.getElementById('char-count');
            let btn = document.getElementById('btn-q1');

            countEl.innerText = count + " / 50";
            
            if(count >= 50) {
                countEl.style.color = "green";
                btn.style.opacity = "1";
                btn.style.pointerEvents = "auto";
            } else {
                countEl.style.color = "red";
                btn.style.opacity = "0.5";
                btn.style.pointerEvents = "none";
            }
        }

        // --- –í–û–ü–†–û–° 2 (–î–æ–Ω–µ—Ä) ---
        function checkFood() {
            let val = document.getElementById('food-input').value.trim().toLowerCase();
            if(val === "–¥–æ–Ω–µ—Ä" || val === "—à–∞—É—Ä–º–∞") { // –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —à–∞—É—Ä–º—É —Ç–æ–∂–µ –¥–æ–±–∞–≤–∏–ª
                nextScreen('screen6');
            } else {
                alert("–ù–µ–∞! –ü–æ–¥—Å–∫–∞–∑–∫–∞: —ç—Ç–æ –≤–∫—É—Å–Ω–æ –∏ –≤ –ª–∞–≤–∞—à–µ.");
            }
        }

        // --- –§–ò–ù–ê–õ (–¢–∞–π–º–µ—Ä) ---
        // –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ 7 —ç–∫—Ä–∞–Ω
        const originalNextScreen = nextScreen;
        nextScreen = function(id) {
            originalNextScreen(id);
            if(id === 'screen7') {
                startFinalTimer();
            }
        }

        function startFinalTimer() {
            let t = 5;
            let el = document.getElementById('boob-timer');
            let interval = setInterval(() => {
                t--;
                el.innerText = t;
                if(t <= 0) {
                    clearInterval(interval);
                    nextScreen('screen8'); // –ü–æ–±–µ–¥–∞
                }
            }, 1000);
        }

    </script>
</body>
</html>
